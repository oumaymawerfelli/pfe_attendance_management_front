<!-- src/app/routes/users/users.component.html -->
<div class="users-container">
  
  <!-- Page Header -->
  <div class="page-header">
    <h1>User Management</h1>
    <p class="page-description">Manage system users and their access permissions</p>
  </div>

  <!-- Stats Cards - FIXED: removed async pipe -->
  <div class="stats-grid" *ngIf="stats">
    <div class="stat-card pending" (click)="filterByStatus('PENDING')">
      <div class="stat-content">
        <mat-icon class="stat-icon">pending_actions</mat-icon>
        <div class="stat-info">
          <p class="stat-value">{{ stats.pending }}</p>
          <p class="stat-label">Pending Approval</p>
        </div>
      </div>
    </div>

    <div class="stat-card active" (click)="filterByStatus('ACTIVE')">
      <div class="stat-content">
        <mat-icon class="stat-icon">check_circle</mat-icon>
        <div class="stat-info">
          <p class="stat-value">{{ stats.active }}</p>
          <p class="stat-label">Active Users</p>
        </div>
      </div>
    </div>

    <div class="stat-card disabled" (click)="filterByStatus('DISABLED')">
      <div class="stat-content">
        <mat-icon class="stat-icon">block</mat-icon>
        <div class="stat-info">
          <p class="stat-value">{{ stats.disabled }}</p>
          <p class="stat-label">Disabled</p>
        </div>
      </div>
    </div>

    <div class="stat-card locked" (click)="filterByStatus('LOCKED')">
      <div class="stat-content">
        <mat-icon class="stat-icon">lock</mat-icon>
        <div class="stat-info">
          <p class="stat-value">{{ stats.locked }}</p>
          <p class="stat-label">Locked</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Search Section -->
  <div class="search-section">
    <mat-form-field appearance="outline" class="search-field">
      <mat-icon matPrefix>search</mat-icon>
      <input matInput #searchInput placeholder="Search users..." (keyup)="applyFilter(searchInput.value)">
    </mat-form-field>
  </div>

  <!-- Table Card -->
  <div class="table-card">
    <div class="table-header">
      <h3>Users</h3>
    </div>

    <div class="table-wrapper">
      <table>
        <thead>
          <tr>
            <th>USER</th>
            <th>CONTACT</th>
            <th>DEPARTMENT</th>
            <th>ROLE</th>
            <th>STATUS</th>
            <th>ACTIONS</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let user of users">
            <td>
              <div class="user-cell">
                <div class="user-avatar">{{ getInitials(user) }}</div>
                <div class="user-info">
                  <div class="user-name">{{ user.firstName }} {{ user.lastName }}</div>
                  <div class="user-email">{{ user.email }}</div>
                </div>
              </div>
            </td>
            <td>
              <div class="contact-cell">
                <div class="user-phone">{{ user.phone || '—' }}</div>
                <div class="user-email-small">{{ user.email }}</div>
              </div>
            </td>
            <td>
              <span class="department-cell">{{ user.department || '—' }}</span>
            </td>
            <td>
              <span class="role-badge">{{ getRoleLabel(user) }}</span>
            </td>
            <td>
              <span class="status-badge" [ngClass]="getStatus(user)">
                <span class="status-dot"></span>
                {{ getStatus(user) | titlecase }}
              </span>
            </td>
           <!-- Dans src/app/routes/users/users.component.html - Remplacer la section actions-cell -->

<td>
  <div class="actions-cell">
    <ng-container *ngIf="canToggleStatus">
      
      <!-- PENDING: Approve + Reject -->
      <ng-container *ngIf="getStatus(user) === 'pending'">
        <button class="action-btn approve" (click)="approveUser(user)">Approve</button>
        <button class="action-btn reject" (click)="rejectUser(user)">Reject</button>
      </ng-container>

      <!-- ACTIVE: Can disable -->
      <button *ngIf="getStatus(user) === 'active'" 
              class="action-btn disable" 
              (click)="disableUser(user)">
        Disable
      </button>

      <!-- DISABLED: Can re-enable -->
      <button *ngIf="getStatus(user) === 'disabled'" 
              class="action-btn enable" 
              (click)="enableUser(user)">
        Enable
      </button>

      <!-- LOCKED: Unlock option -->
      <button *ngIf="getStatus(user) === 'locked'" 
              class="action-btn enable" 
              (click)="enableUser(user)">
        Unlock
      </button>

    </ng-container>

    <!-- Menu with View and Edit options -->
    <button mat-icon-button class="more-btn" [matMenuTriggerFor]="menu">
      <mat-icon>more_vert</mat-icon>
    </button>
    <mat-menu #menu="matMenu">
      <button mat-menu-item (click)="viewUser(user)">
        <mat-icon>person</mat-icon> View Profile
      </button>
      <button mat-menu-item (click)="editUser(user)">
        <mat-icon>edit</mat-icon> Edit
      </button>
    </mat-menu>
  </div>
</td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Loading State -->
    <div class="loading-shade" *ngIf="isLoading">
      <mat-spinner diameter="40"></mat-spinner>
    </div>

    <!-- Empty State -->
    <div class="empty-state" *ngIf="!isLoading && users.length === 0">
      <mat-icon>people_outline</mat-icon>
      <p>No users found</p>
    </div>

    <!-- Pagination -->
    <div class="pagination" *ngIf="totalElements > 0">
      <div class="pagination-info">
        Showing {{ currentPage * pageSize + 1 }} to {{ min((currentPage + 1) * pageSize, totalElements) }} of {{ totalElements }} users
      </div>
      <div class="pagination-controls">
        <button mat-stroked-button class="page-btn" [disabled]="currentPage === 0" (click)="onCustomPageChange(currentPage - 1)">
          <mat-icon>chevron_left</mat-icon>
        </button>
        <button mat-stroked-button class="page-btn active">{{ currentPage + 1 }}</button>
        <button mat-stroked-button class="page-btn" [disabled]="(currentPage + 1) * pageSize >= totalElements" (click)="onCustomPageChange(currentPage + 1)">
          <mat-icon>chevron_right</mat-icon>
        </button>
      </div>
    </div>
  </div>
</div>